generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MANAGER
  USER
}

enum ResourceCategory {
  ROOM
  EQUIPMENT
  VEHICLE
  WORKSTATION
}

enum ResourceStatus {
  AVAILABLE
  MAINTENANCE
  OUT_OF_SERVICE
}

enum BookingStatus {
  CONFIRMED
  PENDING
  CANCELLED
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  password   String
  firstName  String?
  lastName   String?
  role       Role     @default(USER)
  department Department? @relation(fields: [departmentId], references: [id])
  departmentId String?
  avatarUrl  String?
  createdAt  DateTime @default(now())
  bookings   Booking[]
  notifications Notification[]
}

model Department {
  id String @id @default(cuid())
  name String
  description String?
  users User[]
  resources Resource[]
}

model Resource {
  id String @id @default(cuid())
  name String
  description String?
  category ResourceCategory
  capacity Int?
  features Json?
  imageUrl String?
  location String?
  status ResourceStatus @default(AVAILABLE)
  department Department? @relation(fields: [departmentId], references: [id])
  departmentId String?
  requiresApproval Boolean @default(false)
  createdAt DateTime @default(now())
  bookings Booking[]
}

model Booking {
  id String @id @default(cuid())
  resource Resource @relation(fields: [resourceId], references: [id])
  resourceId String
  user User @relation(fields: [userId], references: [id])
  userId String
  startTime DateTime
  endTime DateTime
  title String
  notes String?
  status BookingStatus @default(CONFIRMED)
  isRecurring Boolean @default(false)
  recurrenceRule String?
  parentBookingId String?
  createdAt DateTime @default(now())
}

model Notification {
  id String @id @default(cuid())
  user User @relation(fields: [userId], references: [id])
  userId String
  type String
  message String
  isRead Boolean @default(false)
  relatedBookingId String?
  createdAt DateTime @default(now())
}
